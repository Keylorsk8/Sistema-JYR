@model Sistema_JYR.Models.Pedidos
@using Sistema_JYR.Models;
@{

    SistemaJYREntities db = new SistemaJYREntities();
    List<PedidoDetalle> ped = db.PedidoDetalle.ToList();
}


<div class="container">

    <div id="carritoAjax">
        <div class="card bg-light mb-12">
            <div class="card-header">Materiales en la Orden</div>
            <div class="card-body">
                <table class="table">
                    <tr>
                        <th>
                            Producto
                        </th>
                        <th>
                            Cantidad
                        </th>
                        <th>
                            Cantidad Enviada
                        </th>
                        <th>
                            Precio Unitario
                        </th>
                        <th>
                            Descuento
                        </th>

                        <th>Subtotal</th>
                        <th></th>
                    </tr>

                    @foreach (var item in ped)
                    {
                        <tr>
                            <td>
                                @item.Productos.Nombre
                            </td>
                            <td>
                                @*Otra posible y mejor forma de hacerlo*@
                                <input type="text" id="@item.IdProducto" value="@item.Cantidad" class="form-control" onchange="CambiarCantidadPedida(@item.IdProducto)" />
                                <script>
                                            function CambiarCantidadPedida(id) {
                                        var cantidad = $('#' + id).val();
                                        //alert(id + ' ' + cantidad);
                                        //De acá hacer metodo ajax con jquery

                                        var dataObject = JSON.stringify({
                                            'terminoBusqueda': cantidad,
                                            'id':id
                                        })
                                        var objeto = new Object();
                                        objeto.terminoBusqueda = cantidad;
                                        objeto.id = id;

                                        var url = "@Url.Action("CambiarCantidadPedida", "Pedido")";
                                        var data = {terminoBusqueda: cantidad, id: id};
                                        $.post(url, data).done(function (data) {
                                            $("#carritoAjax").html(data);
                                        })
                                    }
                                </script>
                            </td>
                            <td>
                                @*Otra posible y mejor forma de hacerlo*@
                                <input type="text" id="@item.IdProducto" value="@item.CantidadEnviada" class="form-control" onchange="CambiarCantidad(@item.IdProducto)" />
                                <script>
                                            function CambiarCantidad(id) {
                                        var cantidad = $('#' + id).val();
                                        //alert(id + ' ' + cantidad);
                                        //De acá hacer metodo ajax con jquery

                                        var dataObject = JSON.stringify({
                                            'terminoBusqueda': cantidad,
                                            'id':id
                                        })
                                        var objeto = new Object();
                                        objeto.terminoBusqueda = cantidad;
                                        objeto.id = id;

                                        var url = "@Url.Action("CambiarCantidad", "Pedido")";
                                        var data = {terminoBusqueda: cantidad, id: id};
                                        $.post(url, data).done(function (data) {
                                            $("#carritoAjax").html(data);
                                        })
                                    }
                                </script>
                            </td>

                            <td>
                                @item.PrecioUnitario
                            </td>
                            <td>
                                @item.Descuento
                            </td>
                            <td>
                                ₡@(item.PrecioUnitario * item.Cantidad)
                            </td>
                            <td>

                                @Ajax.ActionLink("Eliminar", "EliminarCarrito", "Pedido", new { idD = item.Id, idPedido = item.IdPedido }, new AjaxOptions { HttpMethod = "GET", UpdateTargetId = "carritoAjax", InsertionMode = InsertionMode.Replace }, htmlAttributes: new { @class = "btn btn-success btn-block" })
                            </td>
                        </tr>

                    }
                    <tr>
                        <td colspan="3"></td>
                        <th>
                            <label>Total Descuento</label>
                        </th>
                        <th>
                            <label>₡@ViewBag.TotalDescuento</label>
                        </th>
                    </tr>
                    <tr>
                        <td colspan="3"></td>
                        <th>
                            <label>Total Impuesto</label>
                        </th>
                        <th>
                            <label>₡@ViewBag.TotalImpuesto</label>
                        </th>
                    </tr>
                    <tr>
                        <td colspan="3"></td>
                        <th>
                            <label>Total Pagar</label>
                        </th>
                        <th>
                            <label>₡@ViewBag.TotalPagar</label>
                        </th>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>